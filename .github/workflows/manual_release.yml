name: Manual Release

on:
  workflow_dispatch:

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    env:
      CARGO_TERM_PROGRESS_WHEN: never

    concurrency:
      group: manual-release-${{ github.ref }}
      cancel-in-progress: true

    steps:
      - name: Download release binary
        shell: bash
        env:
          BINARY_NAME: rust-hh-feed
        run: |
          set -euo pipefail
          curl -sSL -o "$BINARY_NAME" \
            "https://github.com/${{ github.repository }}/releases/latest/download/$BINARY_NAME"
          chmod +x "$BINARY_NAME"

      - name: Run bot
        shell: bash
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          RUST_LOG: info
          BINARY_NAME: rust-hh-feed
        run: |
          set -euo pipefail
          "./$BINARY_NAME"
